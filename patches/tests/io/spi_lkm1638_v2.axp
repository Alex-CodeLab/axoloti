<patch-1.0>
   <obj type="spi.begin" sha="8491453740b6fc6b2fcf5de6e9eb65baa370f6e4" name="spi.begin_1" x="60" y="40">
      <params/>
      <attribs>
         <combo attributeName="clock_polarity" selection="0 when idle"/>
         <combo attributeName="clock_phase" selection="first clock transition is the first data capture edge"/>
         <combo attributeName="baudrate" selection="FPCLK/128"/>
         <combo attributeName="format" selection="LSB first"/>
      </attribs>
   </obj>
   <obj type="osc" sha="6215955d70f249301aa4141e75bdbc58d2782ae6" name="osc_1" x="40" y="180">
      <params>
         <frac32.s.map name="pitch" value="-64.0"/>
      </params>
      <attribs/>
   </obj>
   <obj type="bipolar2unipolar" sha="b80b299df9cb5523b1c4c0c7fe09941a1c682112" name="bipolar2unipolar_1" x="180" y="180">
      <params/>
      <attribs/>
   </obj>
   <obj type="*c" sha="1ea155bb99343babad87e3ff0de80e6bf568e8da" name="*c_1" x="300" y="180">
      <params>
         <frac32.u.map name="amp" value="63.0"/>
      </params>
      <attribs/>
   </obj>
   <obj type="script2" sha="d4319422198752d393898f325781b3081713fc6d" name="script2_1" x="380" y="180">
      <params/>
      <attribs>
         <text attributeName="script">
            <sText><![CDATA[uint8_t *xbuf;

void tm1638_send_command(uint8_t x){
	spiSelect(&SPID1);
	xbuf[0] = x;
	spiSend(&SPID1,1,&xbuf[0]);
	spiUnselect(&SPID1);
}

void tm1638_send_data(uint8_t addr, uint8_t data){
	tm1638_send_command(0x44);
	xbuf[0] = addr|0xc0;
	xbuf[1] = data;
	spiSelect(&SPID1);
	spiSend(&SPID1,2,xbuf);
	spiUnselect(&SPID1);
}

void tm1638_set_led(uint8_t led, uint8_t cols){
	tm1638_send_data((led << 1) + 1, cols);
}

char i;

void setup(){
	static uint8_t _xbuf[16] __attribute__ ((section (".sram2")));
	xbuf = _xbuf;
	
	tm1638_send_command(0x8F);
	i = 0;
}

void loop(){
	i++;
	chThdSleepMilliseconds(1);
	tm1638_set_led((i&0x7), in1>>21);
}]]></sText>
         </text>
      </attribs>
   </obj>
   <obj type="scopeS" sha="b9b02744d6b88f8f435bf781a4fceb74eff28373" name="scopeS_1" x="180" y="220">
      <params/>
      <attribs/>
   </obj>
   <nets>
      <net>
         <source name="osc_1 wave"/>
         <dest name="bipolar2unipolar_1 i"/>
         <dest name="scopeS_1 in"/>
      </net>
      <net>
         <source name="bipolar2unipolar_1 o"/>
         <dest name="*c_1 in"/>
      </net>
      <net>
         <source name="*c_1 out"/>
         <dest name="script2_1 in1_"/>
      </net>
   </nets>
   <settings>
      <subpatchmode>no</subpatchmode>
   </settings>
   <notes><![CDATA[]]></notes>
</patch-1.0>